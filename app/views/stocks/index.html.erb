<h1>Portfolio</h1>

<% if @stocks.length < 8 %>
  <%= link_to "Add New Stock", new_stock_path, class: "btn btn-primary my-4" %>
<% else %>
  <p>You've reached the limit of 8 stocks per portfolio, to add more please delete one of your saved stocks</p>
<% end %>

<div id="stocks">
  <div class="row d-flex justify-content-center">

    <% @stocks.each do |stock| %>
    
    <% quote_hash = JSON.parse((@finnhub_client.quote(stock.ticker)).to_json) %>
    <% profile_hash = JSON.parse((@finnhub_client.company_profile2({symbol: stock.ticker})).to_json) %>
    <% metric_hash = JSON.parse((@finnhub_client.company_basic_financials(stock.ticker, 'all')).to_json) %>

    <div class="col-md-6 col-lg-4 col-xl-3 d-flex justify-content-center">
      <div class="card stock-card">
        <%= render 'stock', :quote => quote_hash, :profile => profile_hash, :metric => metric_hash %>
        <div>
          <%= link_to "Show Details", stock, class: "btn btn-primary" %>
          <%= link_to "Delete", stock, data: { turbo_method: :delete, turbo_confirm: "Are you sure you want to delete this stock from your portfolio?" }, class: "btn btn-danger mx-1" %>
        </div>  
      </div>
    </div>

    <% end %>
    
  </div>
  <p class="fw-light fst-italic text-end">* All prices shown in USD<p>

</div>